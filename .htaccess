# EcoShot (Apache) - routing + basic hardening
# Wymaga: mod_rewrite, mod_headers

Options -Indexes

<IfModule mod_rewrite.c>
  RewriteEngine On

  # Jeśli aplikacja jest w subfolderze, ustaw poprawny RewriteBase, np.:
  # RewriteBase /ecoshot/

  # Canonical: bez końcowego slasha (dla ścieżek nie-będących katalogami)
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^(.+)/$ /$1 [R=301,L]

  # Nie przepisywać istniejących plików i katalogów
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]

  # SPA fallback: wszystko inne do index.php
  RewriteRule ^ index.php [L]
</IfModule>

<IfModule mod_headers.c>
  # Podstawowe nagłówki bezpieczeństwa
  Header always set X-Content-Type-Options "nosniff"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  Header always set X-Frame-Options "SAMEORIGIN"

  # Opcjonalnie (jeśli nie używasz inline JS/CSS, można zaostrzyć CSP)
  # Header always set Content-Security-Policy "default-src 'self'; img-src 'self' data:; media-src 'self'; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; script-src 'self' https://cdn.jsdelivr.net; font-src 'self' https://cdnjs.cloudflare.com data:"
</IfModule>

# Cache statycznych zasobów (bez wpływu na index.php / API)
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType text/css "access plus 7 days"
  ExpiresByType application/javascript "access plus 7 days"
  ExpiresByType image/png "access plus 30 days"
  ExpiresByType image/jpeg "access plus 30 days"
  ExpiresByType image/webp "access plus 30 days"
  ExpiresByType video/webm "access plus 30 days"
  ExpiresByType image/svg+xml "access plus 30 days"
  ExpiresByType font/woff2 "access plus 365 days"
</IfModule>
